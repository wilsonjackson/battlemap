{"version":3,"sources":["lib/storage.js","hooks/useStorage.js","hooks/useBattle.js","contexts/BattleContext.js","contexts/TokenContext.js","components/Map.js","components/GridLines.js","components/Token.js","hooks/useKeys.js","components/GridToken.js","components/Grid.js","components/GridController.js","components/NewToken.js","components/ProtoToken.js","components/TokenTrash.js","components/TokenPalette.js","hooks/useGrid.js","components/TokenInfo.js","components/BackgroundLayers.js","components/TokenGraveyard.js","App.js","serviceWorker.js","index.js"],"names":["handlersByName","currentStateName","localStorageName","handlerName","callSaveHandler","stateToSave","getState","window","localStorage","setItem","JSON","stringify","callLoadHandler","stateToLoad","getItem","setState","parse","load","stateName","Object","keys","forEach","useStorage","name","watchedState","memoizedGetState","useCallback","memoizedSetState","useEffect","assign","registerHandler","concat","initialState","map","nextTokenId","tokenNumbers","protoTokens","tokensOnGrid","tokensInGraveyard","BattleContext","createContext","subscribers","Set","pub","event","data","s","token","setToken","placeHolder","Map","update","onSelect","useState","mapSrc","updateMapSrc","input","React","createRef","updateBounds","current","src","bounds","getBoundingClientRect","left","top","width","height","loadMap","file","reader","FileReader","onload","e","mapData","contents","target","result","toString","readAsDataURL","preventDefault","receiveFile","dataTransfer","files","addEventListener","removeEventListener","setTimeout","reloadLastMap","ref","onLoad","alt","GridLines","grid","orientation","size","tileSize","style","reverse","join","X","Y","className","Token","props","color","number","maxHp","hp","backgroundColor","Math","round","useKeys","mapping","mousetrap","useRef","node","reset","Mousetrap","entries","key","action","bind","GridToken","id","zIndex","endDrag","self","tokenContext","useContext","TokenContext","useDrag","item","type","collect","monitor","isDragging","end","drag","handlers","onMouseDown","onClick","stopPropagation","el","focus","fontSize","visibility","composeRefs","tabIndex","Grid","battle","speedToken","setSpeedToken","cellToCoords","x","y","useDrop","accept","hover","drop","floor","coordsToCell","normalizeCoords","getClientOffset","abs","addToken","updateToken","console","log","show","speed","ftPerTile","offsetX","offsetY","GridController","value","onChange","parseInt","parseFloat","checked","NewToken","tokenInfo","updateTokenInfo","i","placeholder","ProtoToken","TokenTrash","onDrop","TokenPalette","newToken","uiState","updateUi","deleteProtoToken","addProtoToken","TokenInfo","doDamage","doHeal","heal","dmg","hpDelta","setHpDelta","hpDeltaField","changes","applyHp","delta","changeSpeed","fn","subscriber","add","delete","unsub","select","onKeyUp","BackgroundLayers","TokenGraveyard","moveTokenToGraveyard","App","updateGrid","state","gridController","overrides","prototype","useGrid","updateBattle","battleController","filter","t","Battle","useBattle","Provider","DndProvider","backend","HTML5Backend","Boolean","location","hostname","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.d26c29ab.chunk.js","sourcesContent":["const handlersByName = {};\nlet currentStateName = null;\n\nexport const registerHandler = (name, getState, setState) => {\n  if (getState) {\n    handlersByName[name] = Object.assign({}, handlersByName[name], {getState});\n  }\n  if (setState) {\n    handlersByName[name] = Object.assign({}, handlersByName[name], {setState});\n  }\n};\n\nconst localStorageName = handlerName => `${handlerName}__${currentStateName}`;\n\nconst callSaveHandler = handlerName => {\n  const stateToSave = handlersByName[handlerName].getState();\n  window.localStorage.setItem(localStorageName(handlerName), JSON.stringify(stateToSave));\n};\n\nconst callLoadHandler = (handlerName) => {\n  const stateToLoad = window.localStorage.getItem(localStorageName(handlerName));\n  handlersByName[handlerName].setState(JSON.parse(stateToLoad));\n};\n\nexport const save = (handlerName) => {\n  if (!currentStateName) return;\n  if (handlerName) callSaveHandler(handlerName);\n  else Object.keys(handlersByName).forEach(handlerName => callSaveHandler(handlerName));\n};\n\nexport const load = (stateName, handlerName) => {\n  currentStateName = stateName;\n  if (handlerName) callLoadHandler(handlerName);\n  else Object.keys(handlersByName).forEach(handlerName => callLoadHandler(handlerName));\n};\n","import {useCallback, useEffect} from \"react\";\nimport {registerHandler, save} from \"../lib/storage\";\n\nexport default function useStorage(name, watchedState, getState, setState) {\n  const memoizedGetState = useCallback(getState, watchedState);\n  const memoizedSetState = useCallback(setState, watchedState);\n\n  useEffect(() => {\n    registerHandler(name, memoizedGetState, memoizedSetState);\n    save(name);\n  }, [memoizedGetState, memoizedSetState].concat(watchedState)); // eslint-disable-line react-hooks/exhaustive-deps\n}\n","import {useState} from 'react';\nimport useStorage from './useStorage';\n\nexport const initialState = {\n  map: null,\n  nextTokenId: 1,\n  tokenNumbers: {},\n  protoTokens: [],\n  tokensOnGrid: [],\n  tokensInGraveyard: []\n};\n\nexport default function useBattle() {\n  const [battle, updateBattle] = useState(initialState);\n\n  useStorage('battle_state', [battle],\n    () => battle,\n    (state) => {\n      if (state) updateBattle(Object.assign({}, state));\n      else updateBattle(Object.assign({}, initialState));\n    });\n\n  const battleController = {\n    addProtoToken(token) {\n      updateBattle(Object.assign({}, battle, {\n        protoTokens: [].concat(battle.protoTokens, [token])\n      }));\n    },\n    deleteProtoToken(token) {\n      updateBattle({...battle, ...{protoTokens: battle.protoTokens.filter(t => t.name !== token.name)}});\n    },\n    addToken(token) {\n      const tokenNumbers = Object.assign({}, battle.tokenNumbers, {\n        [token.name]: (battle.tokenNumbers[token.name] || 0) + 1\n      });\n      updateBattle(Object.assign({}, battle, {\n        nextTokenId: battle.nextTokenId + 1,\n        tokenNumbers,\n        tokensOnGrid: [].concat(battle.tokensOnGrid, [{\n          ...token,\n          hp: token.maxHp,\n          id: battle.nextTokenId,\n          number: tokenNumbers[token.name]\n        }])\n      }));\n    },\n    updateToken(token) {\n      updateBattle(Object.assign({}, battle, {\n        tokensOnGrid: battle.tokensOnGrid.map(t => {\n          return t.id === token.id ? {...token} : t;\n        })\n      }));\n    },\n    moveTokenToGraveyard(token) {\n      updateBattle({\n        ...battle,\n        ...{\n          tokensOnGrid: battle.tokensOnGrid.filter(t => t.id !== token.id),\n          tokensInGraveyard: [].concat(battle.tokensInGraveyard, [{...token, type: 'deadToken'}])\n        }\n      });\n    }\n  }\n\n  function Battle() {\n  }\n\n  Battle.prototype = battle;\n  return Object.assign(new Battle(), battleController);\n}\n","import {createContext} from \"react\";\nimport {initialState} from \"../hooks/useBattle\";\n\nconst BattleContext = createContext(initialState);\nexport default BattleContext;\n","import {createContext} from 'react';\n\nconst subscribers = new Set();\n\nexport function sub(fn) {\n  subscribers.add(fn);\n}\n\nexport function unsub(fn) {\n  subscribers.delete(fn);\n}\n\nexport function pub(event, ...data) {\n  subscribers.forEach(s => s[event] && s[event](data));\n}\n\nconst initialState = {\n  token: null,\n  setToken: () => {}\n};\n\nexport default createContext(initialState);\n","import React, {useCallback, useEffect, useState} from \"react\";\n\nconst placeHolder = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n\nconst saveCurrentMap = mapData => {\n  window.localStorage.setItem('saved_map', JSON.stringify(mapData));\n};\n\nconst reloadLastMap = () => {\n  const mapData = window.localStorage.getItem('saved_map');\n  return mapData && JSON.parse(mapData);\n};\n\nexport default function Map({update, onSelect}) {\n  const [mapSrc, updateMapSrc] = useState(placeHolder);\n  const input = React.createRef();\n\n  const updateBounds = useCallback(() => {\n    if (!input.current || input.current.src === placeHolder)\n      return;\n    const bounds = input.current.getBoundingClientRect();\n    update({\n      bounds: {\n        left: bounds.left,\n        top: bounds.top,\n        width: bounds.width,\n        height: bounds.height\n      }\n    });\n  }, [update, input]);\n\n  const loadMap = useCallback(file => {\n    if (!file) {\n      return;\n    }\n    const reader = new FileReader();\n    reader.onload = e => {\n      const contents = e.target.result.toString();\n      updateMapSrc(contents);\n      saveCurrentMap({name: file.name, contents});\n    }\n    reader.readAsDataURL(file);\n    onSelect(file.name);\n  }, [onSelect]);\n\n  useEffect(() => {\n    const preventDefault = e => {\n      e.preventDefault();\n    };\n    const receiveFile = e => {\n      e.preventDefault();\n      loadMap(e.dataTransfer.files[0]);\n    };\n    window.addEventListener('resize', updateBounds);\n    window.addEventListener('dragover', preventDefault);\n    window.addEventListener('drop', receiveFile);\n    return () => {\n      window.removeEventListener('resize', updateBounds);\n      window.removeEventListener('dragover', preventDefault);\n      window.removeEventListener('drop', receiveFile);\n    }\n  }, [loadMap, updateBounds]);\n\n  useEffect(() => {\n    // Delay initialization of saved map to wait for all components to finish registering their load handlers\n    setTimeout(() => {\n      const mapData = reloadLastMap();\n      if (mapData) {\n        updateMapSrc(mapData.contents);\n        onSelect(mapData.name);\n      }\n    });\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return (\n    <img src={mapSrc} ref={input} onLoad={updateBounds} alt=\"drag &amp; drop map\"/>\n  );\n}\n","import React from \"react\";\n\nexport function GridLines({grid, orientation}) {\n  const color = '#00000060';\n  const size = grid.tileSize || 20;\n  const style = {\n    [`backgroundPosition${orientation}`]: `${grid['offset' + orientation]}px`,\n    backgroundSize: (s => orientation === 'X' ? s : s.reverse())([`${size}px`, '100%']).join(' '),\n    backgroundImage: `linear-gradient(to ${{\n      X: 'right',\n      Y: 'bottom'\n    }[orientation]}, #0000, #0000 ${size - 1}px, ${color} ${size - 1}px)`\n  };\n  return (\n    <div className=\"grid-display\" style={style}/>\n  );\n}","import React from \"react\";\nimport './Token.css';\n\nexport default function Token(props) {\n  const {color, name, number, maxHp, hp} = props;\n\n  const style = {\n    backgroundColor: color\n  };\n\n  return (\n    <div className=\"token\" style={style}>\n      <span className=\"name\">{name[0]}</span>\n      {number && <span className=\"number\">{number}</span>}\n      {'hp' in props && (\n        <div className=\"health\">\n          <div className=\"current\" style={{width: `${hp > 0 ? Math.round(hp / maxHp * 100) : 0}%`}}/>\n        </div>\n      )}\n    </div>\n  );\n}","import {useCallback, useRef} from \"react\";\nimport Mousetrap from 'mousetrap';\n\nexport default function useKeys(mapping) {\n  const mousetrap = useRef();\n\n  return useCallback(node => {\n    if (mousetrap.current) {\n      mousetrap.current.reset();\n    }\n    if (node) {\n      mousetrap.current = new Mousetrap(node);\n      for (let [key, action] of Object.entries(mapping)) {\n        mousetrap.current.bind(key, action);\n      }\n    }\n  }, [mapping]);\n};\n","import React, {useContext, useEffect, useRef} from 'react';\nimport Token from './Token';\nimport {useDrag} from 'react-dnd';\nimport composeRefs from '@seznam/compose-react-refs/composeRefs';\nimport useKeys from '../hooks/useKeys';\nimport './GridToken.css';\nimport TokenContext, {pub} from '../contexts/TokenContext';\n\nexport default function GridToken(props) {\n  const {id, zIndex, width, height, left, top, endDrag} = props;\n  const self = useRef();\n  const tokenContext = useContext(TokenContext);\n  const keys = useKeys({\n    'd': () => pub('dmg'),\n    'h': () => pub('heal')\n  });\n  const [{isDragging}, drag] = useDrag({\n    item: Object.assign({}, props, {\n      type: 'token'\n    }),\n    collect: monitor => ({\n      isDragging: monitor.isDragging()\n    }),\n    end: endDrag\n  });\n\n  // noinspection JSUnusedGlobalSymbols\n  const handlers = {\n    onMouseDown: () => {\n      setTimeout(() => {\n        if (!tokenContext.token || tokenContext.token.id !== id)\n          tokenContext.setToken(props);\n      });\n    },\n    onClick: e => e.stopPropagation()\n  };\n\n  useEffect(() => {\n    /** @var {HTMLElement} */\n    const el = self.current;\n    if (tokenContext.token && tokenContext.token.id === id)\n      el.focus();\n  });\n\n  const style = {\n    zIndex: zIndex,\n    ...(width ? {width} : null),\n    ...(height ? {height} : null),\n    ...(width ? {fontSize: `${width / 1.75}px`} : null),\n    left,\n    top,\n    visibility: isDragging ? 'hidden' : 'visible'\n  };\n\n  return (\n    <div ref={composeRefs(self, drag, keys)} className=\"grid-token\" tabIndex=\"-1\" style={style} {...handlers}>\n      <Token {...props}/>\n    </div>\n  );\n};\n","import React, {useContext, useEffect, useState} from 'react';\nimport BattleContext from \"../contexts/BattleContext\";\nimport TokenContext from \"../contexts/TokenContext\";\nimport {useDrop} from \"react-dnd\";\nimport {GridLines} from \"./GridLines\";\nimport GridToken from \"./GridToken\";\nimport './Grid.css';\n\nexport default function Grid({grid}) {\n  const {setToken} = useContext(TokenContext);\n  const battle = useContext(BattleContext);\n  const [speedToken, setSpeedToken] = useState(null);\n  const normalizeCoords = ({x, y}) => ({x: x - grid.bounds.left, y: y - grid.bounds.top});\n  const coordsToCell = ({x, y}) => ({x: Math.floor(x / grid.tileSize), y: Math.floor(y / grid.tileSize)});\n  const cellToCoords = ({x, y}) => ({x: x * grid.tileSize, y: y * grid.tileSize});\n\n  const [, drop] = useDrop({\n    accept: ['token', 'protoToken'],\n    hover: (item, monitor) => {\n      if (item.type === 'token' && (!speedToken || item.id !== speedToken.id)) {\n        setSpeedToken(item);\n      }\n    },\n    drop: (item, monitor) => {\n      const {x, y} = coordsToCell(normalizeCoords(monitor.getClientOffset()));\n      const {x: left, y: top} = cellToCoords({x, y});\n      const token = {...item, width: grid.tileSize, height: grid.tileSize, x, y, left, top, zIndex: Math.abs(grid.height - y) + x};\n      switch (item.type) {\n        case 'protoToken':\n          battle.addToken(token);\n          break;\n        case 'token':\n          battle.updateToken(token);\n          break;\n        default:\n          console.log(`Unexpected drop item type: ${item.type}`);\n      }\n    }\n  });\n\n  useEffect(() => {\n    battle.tokensOnGrid.forEach(token => {\n      if (token.width !== grid.tileSize) {\n        const {x: left, y: top} = cellToCoords(token);\n        battle.updateToken({...token, width: grid.tileSize, height: grid.tileSize, left, top});\n      }\n    });\n  });\n\n  return grid.bounds.width > 0 && (\n    <div className=\"grid-container\" style={grid.bounds}>\n      {grid.show && [\n        <GridLines key=\"x\" grid={grid} orientation=\"X\"/>,\n        <GridLines key=\"y\" grid={grid} orientation=\"Y\"/>\n      ]}\n      {speedToken && <div className=\"speed-radius\" style={{\n        width: grid.tileSize + grid.tileSize * (speedToken.speed / grid.ftPerTile) * 2,\n        height: grid.tileSize + grid.tileSize * (speedToken.speed / grid.ftPerTile) * 2,\n        left: speedToken.left - (grid.tileSize * (speedToken.speed / grid.ftPerTile)),\n        top: speedToken.top - (grid.tileSize * (speedToken.speed / grid.ftPerTile))\n      }}/>}\n      <div ref={drop} className=\"grid\" onClick={() => setToken(null)}\n           style={{left: grid.offsetX, top: grid.offsetY, width: grid.bounds.width, height: grid.bounds.height}}>\n        {battle.tokensOnGrid.map(token => (\n          <GridToken key={token.id} endDrag={() => setSpeedToken(null)} {...token}/>\n        ))}\n      </div>\n    </div>\n  );\n}\n","import React from \"react\";\nimport './GridController.css';\n\nexport default function GridController({grid, update}) {\n  return (\n    <div className=\"grid-controller form\">\n      <label>Grid Width\n        <input type=\"number\" value={grid.width}\n               onChange={e => update({width: parseInt(e.target.value, 10)})}/>\n      </label>\n      <label>Feet per Tile\n        <input type=\"number\" value={grid.ftPerTile}\n               onChange={e => update({ftPerTile: parseFloat(e.target.value)})}/>\n      </label>\n      <label>Grid X-Offset\n        <input type=\"number\" name=\"grid-offset-x\" value={grid.offsetX}\n               onChange={e => update({offsetX: parseInt(e.target.value, 10)})}/>\n      </label>\n      <label>Grid Y-Offset\n        <input type=\"number\" name=\"grid-offset-y\" value={grid.offsetY}\n               onChange={e => update({offsetY: parseInt(e.target.value, 10)})}/>\n      </label>\n      <label>Show Grid\n        <span>\n          <input type=\"checkbox\" checked={grid.show} onChange={e => update({show: e.target.checked})}/>\n        </span>\n      </label>\n    </div>\n  );\n}","import React, {useState} from \"react\";\n\nexport const NewToken = ({addToken}) => {\n  const [tokenInfo, updateTokenInfo] = useState({name: '', maxHp: 0, speed: 30});\n  const update = i => updateTokenInfo(Object.assign({}, tokenInfo, i));\n  return (\n    <div className=\"new-token form\">\n      <h3>New Token</h3>\n      <label>\n        Name\n        <input type=\"text\" placeholder=\"Token Name\" value={tokenInfo.name}\n               onChange={e => update({name: e.target.value})}/>\n      </label>\n      <label>\n        Hit points\n        <input type=\"number\" value={tokenInfo.maxHp}\n               onChange={e => update({maxHp: parseInt(e.target.value || 0, 10)})}/>\n      </label>\n      <label>\n        Speed (ft)\n        <input type=\"number\" value={tokenInfo.speed}\n               onChange={e => update({speed: parseInt(e.target.value || 0, 10)})}/>\n      </label>\n      <button type=\"button\" onClick={() => addToken(tokenInfo)}>Add</button>\n    </div>\n  );\n};","import React from \"react\";\nimport Token from \"./Token\";\nimport {useDrag} from \"react-dnd\";\nimport './ProtoToken.css';\n\nexport default function ProtoToken(props) {\n  const [, drag] = useDrag({\n    item: Object.assign({}, props, {\n      type: 'protoToken'\n    }),\n    collect: monitor => ({\n      isDragging: monitor.isDragging()\n    })\n  });\n\n  return (\n    <div ref={drag} className=\"proto-token\">\n      <Token {...props}/>\n    </div>\n  );\n};\n","import React from 'react';\nimport './TokenTrash.css';\nimport {useDrop} from 'react-dnd';\n\nexport default function TokenTrash({onDrop}) {\n  const [, drop] = useDrop({\n    accept: ['protoToken'],\n    drop: onDrop\n  });\n\n  return (\n    <div ref={drop} className=\"token-trash\">X</div>\n  );\n}","import React, {useContext, useState} from \"react\";\nimport BattleContext from \"../contexts/BattleContext\";\nimport {NewToken} from \"./NewToken\";\nimport ProtoToken from \"./ProtoToken\";\nimport './TokenPalette.css';\nimport TokenTrash from './TokenTrash';\n\nexport default function TokenPalette() {\n  const battle = useContext(BattleContext);\n  const [uiState, updateUi] = useState({newToken: false});\n\n  const newToken = () => updateUi(Object.assign({}, uiState, {newToken: true}));\n\n  const addToken = tokenInfo => {\n    battle.addProtoToken(tokenInfo);\n    updateUi(Object.assign({}, uiState, {newToken: false}));\n  };\n\n  const deleteToken = tokenInfo => {\n    battle.deleteProtoToken(tokenInfo);\n  };\n\n  return (\n    <div className=\"token-palette\">\n      <div className=\"token-controls\">\n        <button type={\"button\"} onClick={newToken}>Add token</button>\n        <TokenTrash onDrop={deleteToken}/>\n      </div>\n      <div className=\"token-list\">\n        {battle.protoTokens.map((token, i) => (\n          <ProtoToken key={i} {...token}/>\n        ))}\n      </div>\n      {uiState.newToken && <NewToken addToken={addToken}/>}\n    </div>\n  );\n};\n","import {useState} from \"react\";\nimport useStorage from \"./useStorage\";\n\nconst initialState = {\n  map: null,\n  show: true,\n  width: 32,\n  height: 0,\n  tileSize: 0,\n  ftPerTile: 5,\n  offsetX: 1,\n  offsetY: 1,\n  bounds: {\n    left: 0,\n    top: 0,\n    width: 0,\n    height: 0\n  }\n};\n\nexport default function useGrid() {\n  const [grid, updateGrid] = useState(initialState);\n\n  useStorage('grid_state', [grid],\n    () => ({\n      show: grid.show,\n      width: grid.width,\n      ftPerTile: grid.ftPerTile,\n      offsetX: grid.offsetX,\n      offsetY: grid.offsetY\n    }),\n    state => {\n      if (state) updateGrid({...grid, ...state});\n      else updateGrid({...initialState});\n    });\n\n  const gridController = {\n    update(overrides) {\n      updateGrid({...grid, ...overrides});\n    },\n    get tileSize() {\n      return grid.bounds.width / grid.width;\n    },\n    get height() {\n      return Math.round(grid.bounds.height / gridController.tileSize);\n    }\n  };\n\n  function Grid() {\n  }\n\n  Grid.prototype = grid;\n  return Object.assign(new Grid(), gridController);\n}\n","import React, {useCallback, useContext, useEffect, useRef, useState} from 'react';\nimport './TokenInfo.css';\nimport TokenContext, {sub, unsub} from '../contexts/TokenContext';\nimport BattleContext from '../contexts/BattleContext';\nimport useKeys from '../hooks/useKeys';\n\nexport default function TokenInfo() {\n  const battle = useContext(BattleContext);\n  const {token, setToken} = useContext(TokenContext);\n  const keys = useKeys({\n    'd': () => doDamage(),\n    'h': () => doHeal()\n  });\n  const [uiState, updateUi] = useState({heal: false, dmg: false});\n  const [hpDelta, setHpDelta] = useState(0);\n  const hpDeltaField = useRef();\n\n  const updateToken = useCallback(changes => {\n    battle.updateToken({...token, ...changes});\n    setToken({...token, ...changes});\n  }, [token, setToken, battle]);\n  const doDamage = useCallback(() => updateUi({...uiState, ...{dmg: true}}), [uiState]);\n  const doHeal = useCallback(() => updateUi({...uiState, ...{heal: true}}), [uiState]);\n  const applyHp = useCallback(delta => {\n    updateToken({hp: token.hp + delta});\n    updateUi({...uiState, ...{heal: false, dmg: false}});\n    setHpDelta(0);\n  }, [token, updateToken, uiState]);\n  const changeSpeed = useCallback(speed => updateToken({speed}), [updateToken]);\n\n  useEffect(() => {\n    const subscriber = {dmg: doDamage, heal: doHeal, speed: changeSpeed};\n    sub(subscriber);\n    return () => unsub(subscriber);\n  }, [doDamage, doHeal, changeSpeed]);\n\n  useEffect(() => {\n    if (hpDeltaField.current && hpDeltaField.current.value === '0') {\n      hpDeltaField.current.select();\n    }\n  });\n\n  return token && (\n    <div ref={keys} className=\"token-info\" tabIndex=\"-1\">\n      <h3>{token.name} ({token.number})</h3>\n\n      <div className=\"stat\">\n        <span className=\"name\">HP</span>\n        <span className=\"value\">{token.hp}/{token.maxHp}</span>\n        <button type=\"button\" onClick={() => doDamage()}>DMG</button>\n        <button type=\"button\" onClick={() => doHeal()}>HEAL</button>\n        {(uiState.heal || uiState.dmg) && (\n          <div className=\"hp-mod\">\n            {uiState.heal ? 'Heal' : 'Damage'}:\n            <input type=\"number\" value={hpDelta} ref={hpDeltaField}\n                   onChange={e => setHpDelta(parseInt(e.target.value || 0, 10))}\n                   onKeyUp={e => e.key === 'Enter' && applyHp(hpDelta * (uiState.dmg ? -1 : 1))}/>\n          </div>\n        )}\n      </div>\n      <div className=\"stat\">\n        <span className=\"name\">Speed</span>\n        <input className=\"value\" type=\"number\" value={token.speed} onChange={e => changeSpeed(e.target.value)}/>\n      </div>\n    </div>\n  );\n};\n","import React from 'react';\nimport './BackgroundLayers.css';\n\nexport default function BackgroundLayers() {\n  const show = false;\n  return show && (\n    <div className=\"background-layers\">Hello</div>\n  );\n}","import React, {useContext} from 'react';\nimport './TokenGraveyard.css';\nimport BattleContext from '../contexts/BattleContext';\nimport Token from './Token';\nimport {useDrop} from 'react-dnd';\n\nexport default function TokenGraveyard() {\n  const battle = useContext(BattleContext);\n\n  const [, drop] = useDrop({\n    accept: ['token'],\n    drop: item => {\n      battle.moveTokenToGraveyard(item);\n    }\n  })\n\n  return (\n    <div ref={drop} className=\"token-graveyard\">\n      <h3>Graveyard</h3>\n\n      <div className=\"token-list\">\n        {battle.tokensInGraveyard.map(token => (\n          <div className=\"dead-token\">\n            <Token {...token}/>\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n}","import React, {useState} from 'react';\nimport {DndProvider} from 'react-dnd';\nimport {HTML5Backend} from 'react-dnd-html5-backend';\nimport {load} from './lib/storage';\nimport './App.css';\nimport BattleContext from './contexts/BattleContext';\nimport TokenContext from './contexts/TokenContext';\nimport Map from './components/Map';\nimport Grid from './components/Grid';\nimport GridController from './components/GridController';\nimport TokenPalette from './components/TokenPalette';\nimport useBattle from './hooks/useBattle';\nimport useGrid from './hooks/useGrid';\nimport TokenInfo from './components/TokenInfo';\nimport BackgroundLayers from './components/BackgroundLayers';\nimport TokenGraveyard from './components/TokenGraveyard';\n\nexport default function App() {\n  const grid = useGrid();\n  const battle = useBattle();\n  const [token, setToken] = useState(null);\n\n  return (\n    <div className=\"battlemap\">\n      <BattleContext.Provider value={battle}>\n        <TokenContext.Provider value={{token, setToken}}>\n          <DndProvider backend={HTML5Backend}>\n            <Grid grid={grid}/>\n            <Map update={grid.update} onSelect={load}/>\n            <div className=\"left-panel\">\n              <GridController grid={grid} update={grid.update}/>\n              <TokenPalette/>\n              <BackgroundLayers/>\n            </div>\n            <div className=\"right-panel\">\n              <TokenInfo/>\n              <TokenGraveyard/>\n            </div>\n          </DndProvider>\n        </TokenContext.Provider>\n      </BattleContext.Provider>\n    </div>\n  );\n};\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}