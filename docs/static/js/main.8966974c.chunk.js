(this.webpackJsonpbattlemap=this.webpackJsonpbattlemap||[]).push([[0],{24:function(e,t,n){e.exports=n(42)},29:function(e,t,n){},30:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){},38:function(e,t,n){},39:function(e,t,n){},40:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(18),c=n.n(o),i=(n(29),n(2)),u=n(44),l=n(22),s={},d=null,f=function(e){return"".concat(e,"__").concat(d)},m=function(e){var t=s[e].getState();window.localStorage.setItem(f(e),JSON.stringify(t))},b=function(e){var t=window.localStorage.getItem(f(e));s[e].setState(JSON.parse(t))},p=function(e,t){d=e,t?b(t):Object.keys(s).forEach((function(e){return b(e)}))},g=(n(30),n(5)),v=n(3);function h(e,t,n,r){var o=Object(a.useCallback)(n,t),c=Object(a.useCallback)(r,t);Object(a.useEffect)((function(){var t;!function(e,t,n){t&&(s[e]=Object.assign({},s[e],{getState:t})),n&&(s[e]=Object.assign({},s[e],{setState:n}))}(e,o,c),t=e,d&&(t?m(t):Object.keys(s).forEach((function(e){return m(e)})))}),[o,c].concat(t))}var k={map:null,nextTokenId:1,tokenNumbers:{},protoTokens:[],tokensOnGrid:[],tokensInGraveyard:[]};var O=Object(a.createContext)(k),j=new Set;function E(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];j.forEach((function(t){return t[e]&&t[e](n)}))}var w=Object(a.createContext)({token:null,setToken:function(){}}),y="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function T(e){var t=e.update,n=e.onSelect,o=Object(a.useState)(y),c=Object(i.a)(o,2),u=c[0],l=c[1],s=r.a.createRef(),d=Object(a.useCallback)((function(){if(s.current&&s.current.src!==y){var e=s.current.getBoundingClientRect();t({bounds:{left:e.left,top:e.top,width:e.width,height:e.height}})}}),[t,s]),f=Object(a.useCallback)((function(e){if(e){var t=new FileReader;t.onload=function(t){var n,a=t.target.result.toString();l(a),n={name:e.name,contents:a},window.localStorage.setItem("saved_map",JSON.stringify(n))},t.readAsDataURL(e),n(e.name)}}),[n]);return Object(a.useEffect)((function(){var e=function(e){e.preventDefault()},t=function(e){e.preventDefault(),f(e.dataTransfer.files[0])};return window.addEventListener("resize",d),window.addEventListener("dragover",e),window.addEventListener("drop",t),function(){window.removeEventListener("resize",d),window.removeEventListener("dragover",e),window.removeEventListener("drop",t)}}),[f,d]),Object(a.useEffect)((function(){setTimeout((function(){var e=function(){var e=window.localStorage.getItem("saved_map");return e&&JSON.parse(e)}();e&&(l(e.contents),n(e.name))}))}),[]),r.a.createElement("img",{src:u,ref:s,onLoad:d,alt:"drag & drop map"})}var S=n(46);function x(e){var t,n,a=e.grid,o=e.orientation,c=a.tileSize||20,i=(t={},Object(g.a)(t,"backgroundPosition".concat(o),"".concat(a["offset"+o],"px")),Object(g.a)(t,"backgroundSize",(n=["".concat(c,"px"),"100%"],"X"===o?n:n.reverse()).join(" ")),Object(g.a)(t,"backgroundImage","linear-gradient(to ".concat({X:"right",Y:"bottom"}[o],", #0000, #0000 ").concat(c-1,"px, ").concat("#00000060"," ").concat(c-1,"px)")),t);return r.a.createElement("div",{className:"grid-display",style:i})}n(31);function N(e){var t=e.color,n=e.name,a=e.number,o=e.maxHp,c=e.hp,i={backgroundColor:t};return r.a.createElement("div",{className:"token",style:i},r.a.createElement("span",{className:"name"},n[0]),a&&r.a.createElement("span",{className:"number"},a),"hp"in e&&r.a.createElement("div",{className:"health"},r.a.createElement("div",{className:"current",style:{width:"".concat(c>0?Math.round(c/o*100):0,"%")}})))}var C=n(45),A=n(19),I=n.n(A),z=n(20),G=n.n(z);function P(e){var t=Object(a.useRef)();return Object(a.useCallback)((function(n){if(t.current&&t.current.reset(),n){t.current=new G.a(n);for(var a=0,r=Object.entries(e);a<r.length;a++){var o=Object(i.a)(r[a],2),c=o[0],u=o[1];t.current.bind(c,u)}}}),[e])}n(32);function D(e){var t=e.id,n=e.zIndex,o=e.width,c=e.height,u=e.left,l=e.top,s=e.endDrag,d=Object(a.useRef)(),f=Object(a.useContext)(w),m=P({d:function(){return E("dmg")},h:function(){return E("heal")}}),b=Object(C.a)({item:Object.assign({},e,{type:"token"}),collect:function(e){return{isDragging:e.isDragging()}},end:s}),p=Object(i.a)(b,2),g=p[0].isDragging,h=p[1],k={onMouseDown:function(){setTimeout((function(){f.token&&f.token.id===t||f.setToken(e)}))},onClick:function(e){return e.stopPropagation()}};Object(a.useEffect)((function(){var e=d.current;f.token&&f.token.id===t&&e.focus()}));var O=Object(v.a)({zIndex:n},o?{width:o}:null,{},c?{height:c}:null,{},o?{fontSize:"".concat(o/1.75,"px")}:null,{left:u,top:l,visibility:g?"hidden":"visible"});return r.a.createElement("div",Object.assign({ref:I()(d,h,m),className:"grid-token",tabIndex:"-1",style:O},k),r.a.createElement(N,e))}n(34);function H(e){var t=e.grid,n=Object(a.useContext)(w).setToken,o=Object(a.useContext)(O),c=Object(a.useState)(null),u=Object(i.a)(c,2),l=u[0],s=u[1],d=function(e){var n=e.x,a=e.y;return{x:n*t.tileSize,y:a*t.tileSize}},f=Object(S.a)({accept:["token","protoToken"],hover:function(e,t){"token"!==e.type||l&&e.id===l.id||s(e)},drop:function(e,n){var a=function(e){var n=e.x,a=e.y;return{x:Math.floor(n/t.tileSize),y:Math.floor(a/t.tileSize)}}(function(e){var n=e.x,a=e.y;return{x:n-t.bounds.left,y:a-t.bounds.top}}(n.getClientOffset())),r=a.x,c=a.y,i=d({x:r,y:c}),u=i.x,l=i.y,s=Object(v.a)({},e,{width:t.tileSize,height:t.tileSize,x:r,y:c,left:u,top:l,zIndex:Math.abs(t.height-c)+r});switch(e.type){case"protoToken":o.addToken(s);break;case"token":o.updateToken(s);break;default:console.log("Unexpected drop item type: ".concat(e.type))}}}),m=Object(i.a)(f,2)[1];return Object(a.useEffect)((function(){o.tokensOnGrid.forEach((function(e){if(e.width!==t.tileSize){var n=d(e),a=n.x,r=n.y;o.updateToken(Object(v.a)({},e,{width:t.tileSize,height:t.tileSize,left:a,top:r}))}}))})),t.bounds.width>0&&r.a.createElement("div",{className:"grid-container",style:t.bounds},t.show&&[r.a.createElement(x,{key:"x",grid:t,orientation:"X"}),r.a.createElement(x,{key:"y",grid:t,orientation:"Y"})],l&&r.a.createElement("div",{className:"speed-radius",style:{width:t.tileSize+t.tileSize*(l.speed/t.ftPerTile)*2,height:t.tileSize+t.tileSize*(l.speed/t.ftPerTile)*2,left:l.left-t.tileSize*(l.speed/t.ftPerTile),top:l.top-t.tileSize*(l.speed/t.ftPerTile)}}),r.a.createElement("div",{ref:m,className:"grid",onClick:function(){return n(null)},style:{left:t.offsetX,top:t.offsetY,width:t.bounds.width,height:t.bounds.height}},o.tokensOnGrid.map((function(e){return r.a.createElement(D,Object.assign({key:e.id,endDrag:function(){return s(null)}},e))}))))}n(35);function X(e){var t=e.grid,n=e.update;return r.a.createElement("div",{className:"grid-controller form"},r.a.createElement("label",null,"Grid Width",r.a.createElement("input",{type:"number",value:t.width,onChange:function(e){return n({width:parseInt(e.target.value,10)})}})),r.a.createElement("label",null,"Feet per Tile",r.a.createElement("input",{type:"number",value:t.ftPerTile,onChange:function(e){return n({ftPerTile:parseFloat(e.target.value)})}})),r.a.createElement("label",null,"Grid X-Offset",r.a.createElement("input",{type:"number",name:"grid-offset-x",value:t.offsetX,onChange:function(e){return n({offsetX:parseInt(e.target.value,10)})}})),r.a.createElement("label",null,"Grid Y-Offset",r.a.createElement("input",{type:"number",name:"grid-offset-y",value:t.offsetY,onChange:function(e){return n({offsetY:parseInt(e.target.value,10)})}})),r.a.createElement("label",null,"Show Grid",r.a.createElement("span",null,r.a.createElement("input",{type:"checkbox",checked:t.show,onChange:function(e){return n({show:e.target.checked})}}))))}var L=function(e){var t=e.addToken,n=Object(a.useState)({name:"",maxHp:0,speed:30}),o=Object(i.a)(n,2),c=o[0],u=o[1],l=function(e){return u(Object.assign({},c,e))};return r.a.createElement("div",{className:"new-token form"},r.a.createElement("h3",null,"New Token"),r.a.createElement("label",null,"Name",r.a.createElement("input",{type:"text",placeholder:"Token Name",value:c.name,onChange:function(e){return l({name:e.target.value})}})),r.a.createElement("label",null,"Hit points",r.a.createElement("input",{type:"number",value:c.maxHp,onChange:function(e){return l({maxHp:parseInt(e.target.value||0,10)})}})),r.a.createElement("label",null,"Speed (ft)",r.a.createElement("input",{type:"number",value:c.speed,onChange:function(e){return l({speed:parseInt(e.target.value||0,10)})}})),r.a.createElement("button",{type:"button",onClick:function(){return t(c)}},"Add"))};n(36);function R(e){var t=Object(C.a)({item:Object.assign({},e,{type:"protoToken"}),collect:function(e){return{isDragging:e.isDragging()}}}),n=Object(i.a)(t,2)[1];return r.a.createElement("div",{ref:n,className:"proto-token"},r.a.createElement(N,e))}n(37),n(38);function Y(e){var t=e.onDrop,n=Object(S.a)({accept:["protoToken"],drop:t}),a=Object(i.a)(n,2)[1];return r.a.createElement("div",{ref:a,className:"token-trash"},"X")}function M(){var e=Object(a.useContext)(O),t=Object(a.useState)({newToken:!1}),n=Object(i.a)(t,2),o=n[0],c=n[1];return r.a.createElement("div",{className:"token-palette"},r.a.createElement("div",{className:"token-controls"},r.a.createElement("button",{type:"button",onClick:function(){return c(Object.assign({},o,{newToken:!0}))}},"Add token"),r.a.createElement(Y,{onDrop:function(t){e.deleteProtoToken(t)}})),r.a.createElement("div",{className:"token-list"},e.protoTokens.map((function(e,t){return r.a.createElement(R,Object.assign({key:t},e))}))),o.newToken&&r.a.createElement(L,{addToken:function(t){e.addProtoToken(t),c(Object.assign({},o,{newToken:!1}))}}))}var B={map:null,show:!0,width:32,height:0,tileSize:0,ftPerTile:5,offsetX:1,offsetY:1,bounds:{left:0,top:0,width:0,height:0}};n(39);function J(){var e=Object(a.useContext)(O),t=Object(a.useContext)(w),n=t.token,o=t.setToken,c=P({d:function(){return k()},h:function(){return E()}}),u=Object(a.useState)({heal:!1,dmg:!1}),l=Object(i.a)(u,2),s=l[0],d=l[1],f=Object(a.useState)(0),m=Object(i.a)(f,2),b=m[0],p=m[1],g=Object(a.useRef)(),h=Object(a.useCallback)((function(t){e.updateToken(Object(v.a)({},n,{},t)),o(Object(v.a)({},n,{},t))}),[n,o,e]),k=Object(a.useCallback)((function(){return d(Object(v.a)({},s,{},{dmg:!0}))}),[s]),E=Object(a.useCallback)((function(){return d(Object(v.a)({},s,{},{heal:!0}))}),[s]),y=Object(a.useCallback)((function(e){h({hp:n.hp+e}),d(Object(v.a)({},s,{},{heal:!1,dmg:!1})),p(0)}),[n,h,s]),T=Object(a.useCallback)((function(e){return h({speed:e})}),[h]);return Object(a.useEffect)((function(){var e,t={dmg:k,heal:E,speed:T};return e=t,j.add(e),function(){return function(e){j.delete(e)}(t)}}),[k,E,T]),Object(a.useEffect)((function(){g.current&&"0"===g.current.value&&g.current.select()})),n&&r.a.createElement("div",{ref:c,className:"token-info",tabIndex:"-1"},r.a.createElement("h3",null,n.name," (",n.number,")"),r.a.createElement("div",{className:"stat"},r.a.createElement("span",{className:"name"},"HP"),r.a.createElement("span",{className:"value"},n.hp,"/",n.maxHp),r.a.createElement("button",{type:"button",onClick:function(){return k()}},"DMG"),r.a.createElement("button",{type:"button",onClick:function(){return E()}},"HEAL"),(s.heal||s.dmg)&&r.a.createElement("div",{className:"hp-mod"},s.heal?"Heal":"Damage",":",r.a.createElement("input",{type:"number",value:b,ref:g,onChange:function(e){return p(parseInt(e.target.value||0,10))},onKeyUp:function(e){return"Enter"===e.key&&y(b*(s.dmg?-1:1))}}))),r.a.createElement("div",{className:"stat"},r.a.createElement("span",{className:"name"},"Speed"),r.a.createElement("input",{className:"value",type:"number",value:n.speed,onChange:function(e){return T(e.target.value)}})))}n(40);function _(){return!1}n(41);function F(){var e=Object(a.useContext)(O),t=Object(S.a)({accept:["token"],drop:function(t){e.moveTokenToGraveyard(t)}}),n=Object(i.a)(t,2)[1];return r.a.createElement("div",{ref:n,className:"token-graveyard"},r.a.createElement("h3",null,"Graveyard"),r.a.createElement("div",{className:"token-list"},e.tokensInGraveyard.map((function(e){return r.a.createElement("div",{className:"dead-token"},r.a.createElement(N,e))}))))}function U(){var e=function(){var e=Object(a.useState)(B),t=Object(i.a)(e,2),n=t[0],r=t[1];h("grid_state",[n],(function(){return{show:n.show,width:n.width,ftPerTile:n.ftPerTile,offsetX:n.offsetX,offsetY:n.offsetY}}),(function(e){r(e?Object(v.a)({},n,{},e):Object(v.a)({},B))}));var o={update:function(e){r(Object(v.a)({},n,{},e))},get tileSize(){return n.bounds.width/n.width},get height(){return Math.round(n.bounds.height/o.tileSize)}};function c(){}return c.prototype=n,Object.assign(new c,o)}(),t=function(){var e=Object(a.useState)(k),t=Object(i.a)(e,2),n=t[0],r=t[1];h("battle_state",[n],(function(){return n}),(function(e){r(e?Object.assign({},e):Object.assign({},k))}));var o={addProtoToken:function(e){r(Object.assign({},n,{protoTokens:[].concat(n.protoTokens,[e])}))},deleteProtoToken:function(e){r(Object(v.a)({},n,{},{protoTokens:n.protoTokens.filter((function(t){return t.name!==e.name}))}))},addToken:function(e){var t=Object.assign({},n.tokenNumbers,Object(g.a)({},e.name,(n.tokenNumbers[e.name]||0)+1));r(Object.assign({},n,{nextTokenId:n.nextTokenId+1,tokenNumbers:t,tokensOnGrid:[].concat(n.tokensOnGrid,[Object(v.a)({},e,{hp:e.maxHp,id:n.nextTokenId,number:t[e.name]})])}))},updateToken:function(e){r(Object.assign({},n,{tokensOnGrid:n.tokensOnGrid.map((function(t){return t.id===e.id?Object(v.a)({},e):t}))}))},moveTokenToGraveyard:function(e){r(Object(v.a)({},n,{},{tokensOnGrid:n.tokensOnGrid.filter((function(t){return t.id!==e.id})),tokensInGraveyard:[].concat(n.tokensInGraveyard,[Object(v.a)({},e,{type:"deadToken"})])}))}};function c(){}return c.prototype=n,Object.assign(new c,o)}(),n=Object(a.useState)(null),o=Object(i.a)(n,2),c=o[0],s=o[1];return r.a.createElement("div",{className:"battlemap"},r.a.createElement(O.Provider,{value:t},r.a.createElement(w.Provider,{value:{token:c,setToken:s}},r.a.createElement(u.a,{backend:l.a},r.a.createElement(H,{grid:e}),r.a.createElement(T,{update:e.update,onSelect:p}),r.a.createElement("div",{className:"left-panel"},r.a.createElement(X,{grid:e,update:e.update}),r.a.createElement(M,null),r.a.createElement(_,null)),r.a.createElement("div",{className:"right-panel"},r.a.createElement(J,null),r.a.createElement(F,null))))))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(U,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[24,1,2]]]);
//# sourceMappingURL=main.8966974c.chunk.js.map